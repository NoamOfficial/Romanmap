<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roman Empire Timeline Map with Wars</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; padding:0; }
  #map { height: 90vh; width: 100%; }
  .slider-container { width: 90%; margin: 10px auto; text-align:center; }
  #yearLabel { font-weight:bold; margin-left:10px; }
  .info { text-align:center; font-size:16px; margin-top:5px; }
</style>
</head>
<body>

<div id="map"></div>
<div class="slider-container">
  <input type="range" min="-800" max="1453" step="1" value="-800" id="yearSlider">
  <span id="yearLabel">800 BCE</span>
</div>
<div class="info" id="infoBox">Etruscan civilization</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([41.9, 12.5], 4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 7,
  attribution: 'Map data © OpenStreetMap contributors'
}).addTo(map);

const infoBox = document.getElementById('infoBox');
const yearLabel = document.getElementById('yearLabel');

// Roman empire polygons
const romanData = [
  { year: -800, polygon: [[42.5, 11.5],[43.0,12.0],[42.0,13.0],[41.5,12.5]], info:"Etruscans (~800 BCE)"},
  { year: -500, polygon: [[42.0,12.0],[42.5,12.5],[41.8,13.0],[41.5,12.5]], info:"Early Rome (~500 BCE)"},
  { year: -200, polygon: [[42.0,10.0],[44.0,13.5],[40.0,14.0],[39.0,11.0]], info:"Roman Republic (509–27 BCE), Punic Wars ongoing"},
  { year: 100, polygon: [[50.0,-10.0],[50.0,40.0],[30.0,40.0],[30.0,-10.0]], info:"Roman Empire peak (~117 CE)"},
  { year: 300, polygon: [[50.0,-10.0],[50.0,40.0],[30.0,40.0],[30.0,-10.0]], info:"Crisis of 3rd Century (270 CE)"},
  { year: 500, polygon: [[46.0,-5.0],[46.0,20.0],[35.0,20.0],[35.0,-5.0]], info:"Western collapse, Eastern survives"},
  { year: 1000, polygon: [[41.0,10.0],[45.0,30.0],[35.0,30.0],[30.0,10.0]], info:"Byzantine Empire recovery under Macedonian dynasty"},
  { year: 1453, polygon: [[41.0,10.0],[45.0,30.0],[35.0,30.0],[30.0,10.0]], info:"Fall of Constantinople"}
];

// Other civilizations
const civs = {
  carthage: {polygon:[[36,-8],[37,-5],[35,-5],[35,-8]], color:'brown', popup:'Carthage (~9th c. BCE–146 BCE)'},
  gauls: {polygon:[[46,0],[50,5],[45,8],[43,2]], color:'green', popup:'Gauls (~600 BCE–50 BCE)'},
  parthians: {polygon:[[30,45],[40,60],[20,60],[20,45]], color:'orange', popup:'Parthians (~247 BCE–224 CE)'}
};

// Major battles
const battles = [
  {lat:41.3, lng:15.2, year:-216, name:"Battle of Cannae"},
  {lat:37.0, lng:14.0, year:-202, name:"Battle of Zama"},
  {lat:40.4, lng:14.2, year:-89, name:"Social War"},
  {lat:31.2, lng:29.9, year:30, name:"Roman annexation of Egypt"},
  {lat:41.0, lng:28.9, year:1453, name:"Fall of Constantinople"}
];

let currentLayer, currentCivs = [], currentBattles = [];

// Update function
function updateMap(year){
  // Update label
  yearLabel.textContent = year < 0 ? `${Math.abs(year)} BCE` : `${year} CE`;

  // Update Roman polygon
  let closest = romanData.reduce((a,b)=> Math.abs(b.year-year)<Math.abs(a.year-year)?b:a);
  if(currentLayer) map.removeLayer(currentLayer);
  currentLayer = L.polygon(closest.polygon, {color:'purple'}).addTo(map);
  map.fitBounds(currentLayer.getBounds());
  infoBox.innerHTML = closest.info;

  // Update civs
  currentCivs.forEach(c=>map.removeLayer(c));
  currentCivs = [];
  if(year>=-500 && year<=-146){currentCivs.push(L.polygon(civs.carthage.polygon,{color:civs.carthage.color}).bindPopup(civs.carthage.popup).addTo(map));}
  if(year>=-600 && year<=-50){currentCivs.push(L.polygon(civs.gauls.polygon,{color:civs.gauls.color}).bindPopup(civs.gauls.popup).addTo(map));}
  if(year>=-247 && year<=224){currentCivs.push(L.polygon(civs.parthians.polygon,{color:civs.parthians.color}).bindPopup(civs.parthians.popup).addTo(map));}

  // Update battles
  currentBattles.forEach(b=>map.removeLayer(b));
  currentBattles = [];
  battles.forEach(b=>{
    if(Math.abs(b.year-year)<=5){ // show battles within ~5 years
      currentBattles.push(L.marker([b.lat,b.lng]).bindPopup(`${b.name} (${b.year<0?Math.abs(b.year)+' BCE':b.year+' CE'})`).addTo(map));
    }
  });
}

// Slider listener
const slider = document.getElementById('yearSlider');
slider.addEventListener('input', ()=>updateMap(parseInt(slider.value)));

// Initial map
updateMap(parseInt(slider.value));
</script>

</body>
</html>

